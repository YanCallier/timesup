<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chapeau</title>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>
    <h1>Le jeu du chapeau</h1>
    <input type="text" placeholder='Ecrire un mot' id='word'></input>
    <button onclick="addWord()">Mettre dans le chapeau</button>
    <br /><br />
    <button onclick="beginTurn()">Jouer un tour</button>
    <strong id="pioche"></strong>
    <spam id="timer"></spam>
    <br /><br />
    <button onclick="reFill()">Remettre les mots dans le chapeau</button>
    <br /><br />
    <button onclick="endGame()">Fin de partie</button>
    <div id="turnView" style="
    display:none; 
    position:absolute; 
    background-color: white; 
    border: 1px solid grey; 
    padding: 5px; 
    top:5px; 
    left:5px;
    height:500px;
    ">
        <div id='big-words' style="font-size: 4vw; text-align: center"></div>
        <div id='guessBtt' style="display:none;  justify-content: center;">
            <button onclick="endWord('ok')" id="doneBtt">Réussi !</button>
            <button onclick="endWord(null)" id="passBtt">Passe !</button>
        </div>
        <div id='little-words' style="font-size: 2vw; text-align: center"></div>
        <div id='big-big-words' style="font-size: 6vw; text-align: center"></div>
    </div>
</body>
<script>
    var points = 0;
    var time = 0.70 * 60 * 1000;
    var currentWord;
    var turnSatus = null;
    socket = io.connect();
    // socket = io.connect('http://localhost:8080');

    function beginTurn() {
        time = 0.70 * 60 * 1000;
        socket.emit('beginTurn');
        document.getElementById('guessBtt').style.display = "flex";
        draw();
    }

    socket.on('beginTurn', () => {
        turnSatus = 'on';
        timeTick();
        document.getElementById('turnView').style.display = "";
    });

    function addWord() {
        var word = document.getElementById('word').value;
        document.getElementById('word').value = "";
        socket.emit('addWord', word);
    }

    function draw() {
        console.log("drawing");
        socket.emit('draw');
    }

    socket.on('draw', (pickedWord) => {
        currentWord = pickedWord;
        if (pickedWord) {
            document.getElementById('big-words').innerHTML = pickedWord;
        } else {
            endTurn('Le chapeau est vide !')
        }
    });

    function endWord(guess) {
        socket.emit('endWord', {
            guess: guess,
            word: currentWord
        });
        draw();
    }

    socket.on('endWord', (guess, word) => {
        var wordColor = "red";
        if (guess) {
            points += 1;
            wordColor = "green"
        }
        var guessWords = document.getElementById('little-words');
        guessWords.innerHTML = guessWords.innerHTML + "<div style='color:" + wordColor + "'>" + word +
            "</div>";
    });

    function timeTick() {
        if (turnSatus) {
            time -= 1000;
            document.getElementById('big-big-words').innerHTML = time / 1000 + " s";
            if (time < 0) {
                endTurn("Temps écoulé !");
            } else {
                setTimeout(timeTick, 1000);
            }
        }
    }

    function endTurn(endReason) {
        socket.emit('endTurn', endReason);
    }

    socket.on('endTurn', (endReason) => {
        turnSatus = null;
        document.getElementById('guessBtt').style.display = "none";
        document.getElementById('big-words').innerHTML = endReason;
        document.getElementById('big-big-words').innerHTML = points + " points";
        points = 0;
        time = 0.70 * 60 * 1000;
        setTimeout(hideTurnView = function () {
            document.getElementById('big-words').innerHTML = "";
            document.getElementById('big-big-words').innerHTML = "";
            document.getElementById('little-words').innerHTML = "";
            document.getElementById('turnView').style.display = "none";
        }, 5000);
    });

    function reFill() {
        socket.emit('reFill');
    }

    function endGame() {
        socket.emit('endGame');
    }
</script>

</html>